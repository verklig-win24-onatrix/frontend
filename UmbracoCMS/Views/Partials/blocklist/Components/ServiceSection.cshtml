@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockListItem>;
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@{
  var content = (ContentModels.ServiceSection)Model.Content;
  var settings = Model.Settings as ContentModels.ServiceSettings;

  var current = Umbraco.AssignedContentItem;
  var siteRoot = current.Root();

  var servicePage = siteRoot.Children<ServicePage>().FirstOrDefault();
  var items = servicePage.Children<ServiceDetail>().OrderByDescending(x => x.CreateDate).ToList() ?? [];

  var sectionColor = settings?.BackgroundColor?.Color ?? string.Empty;
  var sectionColorStyle = !string.IsNullOrEmpty(sectionColor)
    ? $"background-color: {sectionColor} !important;"
    : string.Empty;
}

<section class="service-section" style="@sectionColorStyle">
  <div class="wrapper">

    <div class="flex">
      @if (settings.ShowLabel)
      {
        <h2>@content.ServiceLabel</h2>
      }
      <div class="rte">@Html.Raw(content.ServiceTitle)</div>
    </div>

    <div class="grid">

      @if (items.Any())
      {
        foreach(var item in items)
        {
          <div class="service-card">
            <a href="@item.Url()">
              <h4>@item.Name</h4>
              <img src="@item.ServiceDetailThumbnail.Url()" />
              <p>@item.ServiceDetailExcerpt</p>
            </a>
          </div>
        }
      }
      else
      {
        <p>No Services Available</p>
      }

    </div>

  </div>
</section>